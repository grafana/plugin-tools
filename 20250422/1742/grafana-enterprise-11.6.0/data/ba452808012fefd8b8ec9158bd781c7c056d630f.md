# Test info

- Name: Test new alert rules >> should be possible to add multiple rows
- Location: /home/runner/work/plugin-tools/plugin-tools/packages/plugin-e2e/tests/as-admin-user/datasource/alerting/alerting.basicMode.spec.ts:42:7

# Error details

```
Error: locator.fill: Test timeout of 30000ms exceeded.
Call log:
  - waiting for locator('[aria-label="Query editor row"]').filter({ has: locator('[aria-label="Query editor row title A"]') }).getByTestId('data-testid Select a data source')

    at DataSourcePicker.set (/home/runner/work/plugin-tools/plugin-tools/packages/plugin-e2e/src/models/components/DataSourcePicker.ts:28:28)
    at /home/runner/work/plugin-tools/plugin-tools/packages/plugin-e2e/tests/as-admin-user/datasource/alerting/alerting.basicMode.spec.ts:52:29
```

# Page snapshot

```yaml
- main:
  - img "Grafana"
  - heading "Welcome to Grafana" [level=1]
  - text: Email or username
  - textbox "Email or username"
  - text: Password
  - textbox "Password"
  - switch "Show password"
  - button "Log in"
  - link "Forgot your password?":
    - /url: /user/password/send-reset-email
  - list:
    - listitem:
      - link "Documentation":
        - /url: https://grafana.com/docs/grafana/latest/?utm_source=grafana_footer
      - text: "|"
    - listitem:
      - link "Support":
        - /url: https://grafana.com/products/enterprise/?utm_source=grafana_footer
      - text: "|"
    - listitem:
      - link "Community":
        - /url: https://community.grafana.com/?utm_source=grafana_footer
      - text: "|"
    - listitem:
      - link "Enterprise (Free & unlicensed)":
        - /url: https://grafana.com/products/enterprise/?utm_source=grafana_footer
      - text: "|"
    - listitem:
      - link "Grafana v11.6.0 (d2fdff9ee4)":
        - /url: https://github.com/grafana/grafana/blob/main/CHANGELOG.md
```

# Test source

```ts
   1 | import * as semver from 'semver';
   2 | import { Locator } from '@playwright/test';
   3 | import { PluginTestCtx } from '../../types';
   4 | import { GrafanaPage } from '../pages/GrafanaPage';
   5 |
   6 | export class DataSourcePicker extends GrafanaPage {
   7 |   constructor(
   8 |     ctx: PluginTestCtx,
   9 |     private root?: Locator
  10 |   ) {
  11 |     super(ctx);
  12 |   }
  13 |
  14 |   /**
  15 |    * Sets the data source picker to the provided name
  16 |    */
  17 |   async set(name: string) {
  18 |     let datasourcePicker = (this.root || this.ctx.page).getByTestId(
  19 |       this.ctx.selectors.components.DataSourcePicker.inputV2
  20 |     );
  21 |
  22 |     if (semver.lt(this.ctx.grafanaVersion, '10.1.0')) {
  23 |       datasourcePicker = this.getByGrafanaSelector(this.ctx.selectors.components.DataSourcePicker.container, {
  24 |         root: this.root,
  25 |       }).locator('input');
  26 |     }
  27 |
> 28 |     await datasourcePicker.fill(name);
     |                            ^ Error: locator.fill: Test timeout of 30000ms exceeded.
  29 |
  30 |     // this is a hack to get the selection to work in 10.ish versions of Grafana.
  31 |     // TODO: investigate if the select component can somehow be refactored so that its easier to test with playwright
  32 |     await this.ctx.page.keyboard.press('ArrowDown');
  33 |     await this.ctx.page.keyboard.press('ArrowUp');
  34 |     await this.ctx.page.keyboard.press('Enter');
  35 |   }
  36 | }
  37 |
```

# Local changes

```diff
diff --git a/package-lock.json b/package-lock.json
index e3a2d82d..8e2cdc48 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -23,6 +23,7 @@
         "@auto-it/omit-commits": "11.3.0",
         "@auto-it/slack": "11.3.0",
         "@grafana/eslint-config": "^8.0.0",
+        "@playwright/test": "^1.52.0",
         "@rollup/plugin-commonjs": "^28.0.3",
         "@rollup/plugin-json": "^6.1.0",
         "@rollup/plugin-node-resolve": "^16.0.1",
diff --git a/package.json b/package.json
index 55bf79ab..94a402c9 100644
--- a/package.json
+++ b/package.json
@@ -28,6 +28,7 @@
     "@auto-it/omit-commits": "11.3.0",
     "@auto-it/slack": "11.3.0",
     "@grafana/eslint-config": "^8.0.0",
+    "@playwright/test": "^1.52.0",
     "@rollup/plugin-commonjs": "^28.0.3",
     "@rollup/plugin-json": "^6.1.0",
     "@rollup/plugin-node-resolve": "^16.0.1",
diff --git a/packages/create-plugin/templates/common/playwright.config b/packages/create-plugin/templates/common/playwright.config
index c84567bf..9c8c609f 100644
--- a/packages/create-plugin/templates/common/playwright.config
+++ b/packages/create-plugin/templates/common/playwright.config
@@ -46,10 +46,6 @@ export default defineConfig<PluginOptions>({
       use: {
         ...devices['Desktop Chrome'],
         storageState: 'playwright/.auth/admin.json',
-        launchOptions: {
-          args: ['--disable-features=PlzDedicatedWorker'], // because https://github.com/microsoft/playwright/pull/34400
-        },
-        channel: 'chrome',
       },
       dependencies: ['auth'],
     },
diff --git a/packages/plugin-e2e/playwright.config.ts b/packages/plugin-e2e/playwright.config.ts
index 4621f529..3addcbbf 100644
--- a/packages/plugin-e2e/playwright.config.ts
+++ b/packages/plugin-e2e/playwright.config.ts
@@ -87,9 +87,6 @@ export default defineConfig<PluginOptions>({
       testDir: './tests/as-admin-user',
       use: {
         ...devices['Desktop Chrome'],
-        launchOptions: {
-          args: ['--disable-features=PlzDedicatedWorker'], // because https://github.com/microsoft/playwright/pull/34400
-        },
         storageState: 'playwright/.auth/admin.json',
         viewport: {
           width: 1920,
@@ -105,9 +102,6 @@ export default defineConfig<PluginOptions>({
       testDir: './tests/as-viewer-user',
       use: {
         ...devices['Desktop Chrome'],
-        launchOptions: {
-          args: ['--disable-features=PlzDedicatedWorker'], // because https://github.com/microsoft/playwright/pull/34400
-        },
         storageState: 'playwright/.auth/viewer.json',
         channel: 'chrome',
       },
diff --git a/packages/plugin-e2e/src/models/pages/DashboardPage.ts b/packages/plugin-e2e/src/models/pages/DashboardPage.ts
index 3446d67a..ccb014a1 100644
--- a/packages/plugin-e2e/src/models/pages/DashboardPage.ts
+++ b/packages/plugin-e2e/src/models/pages/DashboardPage.ts
@@ -94,9 +94,10 @@ export class DashboardPage extends GrafanaPage {
       await this.getByGrafanaSelector(components.NavToolbar.editDashboard.editButton).click();
     }
     // on small screens, the toolbar buttons are hidden behind a "Show more items" button
-    const toolbarButtonsHidden = !scenesEnabled && !!(await this.ctx.page.getByLabel('Show more items').count());
+    const showMoreItems = await this.ctx.page.getByLabel('Show more items');
+    const toolbarButtonsHidden = !scenesEnabled && (await showMoreItems.count()) > 0;
     if (toolbarButtonsHidden) {
-      await this.ctx.page.getByLabel('Show more items').click();
+      await showMoreItems.click();
     }
 
     if (semver.gte(this.ctx.grafanaVersion, '9.5.0')) {
diff --git a/packages/plugin-e2e/src/models/pages/GrafanaPage.ts b/packages/plugin-e2e/src/models/pages/GrafanaPage.ts
index 7603e2a2..59ea2e0c 100644
--- a/packages/plugin-e2e/src/models/pages/GrafanaPage.ts
+++ b/packages/plugin-e2e/src/models/pages/GrafanaPage.ts
@@ -19,7 +19,7 @@ export abstract class GrafanaPage {
       url += `?${queryParams.toString()}`;
     }
     await this.ctx.page.goto(url, {
-      waitUntil: 'networkidle',
+      waitUntil: 'load',
       ...this.pageArgs,
       ...options,
     });
diff --git a/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts b/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts
index c8c06927..e176a8b8 100644
--- a/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts
+++ b/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts
@@ -16,6 +16,6 @@ test('should wait for plugin config settings API to respond', async ({ gotoAppCo
   );
 
   const response = configPage.waitForSettingsResponse();
-  await page.getByRole('button', { name: 'Disable' }).first().click();
+  await page.getByRole('button', { name: /Disable|Enable/i }).first().click();
   await expect(response).toBeOK();
 });
diff --git a/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts b/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts
index 51eb8f92..68316e84 100644
--- a/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts
+++ b/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts
@@ -33,3 +33,5 @@ test('should be possible to load and execute an existing valid query', async ({
   await expect(panelEditPage.refreshPanel()).toBeOK();
   await expect(panelEditPage.panel.getErrorIcon()).not.toBeVisible();
 });
+
+// DEBUG=pw:browser
```