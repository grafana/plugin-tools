# Test info

- Name: Test new alert rules >> should evaluate to false if query is invalid
- Location: /home/runner/work/plugin-tools/plugin-tools/packages/plugin-e2e/tests/as-admin-user/datasource/alerting/alerting.advancedMode.spec.ts:43:7

# Error details

```
Error: locator.fill: Test timeout of 30000ms exceeded.
Call log:
  - waiting for locator('[aria-label="Query editor row"]').filter({ has: locator('[aria-label="Query editor row title A"]') }).getByTestId('data-testid Select a data source')

    at DataSourcePicker.set (/home/runner/work/plugin-tools/plugin-tools/packages/plugin-e2e/src/models/components/DataSourcePicker.ts:28:28)
    at /home/runner/work/plugin-tools/plugin-tools/packages/plugin-e2e/tests/as-admin-user/datasource/alerting/alerting.advancedMode.spec.ts:52:29
```

# Page snapshot

```yaml
- link "Skip to main content":
  - /url: "#pageContent"
- button "Close menu":
  - img "Grafana"
- text: Grafana
- button "Undock menu"
- navigation:
  - list "Navigation":
    - listitem:
      - link "Home":
        - /url: /
    - listitem:
      - link "Bookmarks":
        - /url: /bookmarks
      - 'button "Expand section: Bookmarks"'
    - listitem:
      - link "Starred":
        - /url: /dashboards?starred
      - 'button "Expand section: Starred"'
    - listitem:
      - link "Dashboards":
        - /url: /dashboards
      - 'button "Expand section: Dashboards"'
    - listitem:
      - link "Explore":
        - /url: /explore
    - listitem:
      - link "Drilldown New!":
        - /url: /drilldown
      - 'button "Expand section: Drilldown"'
    - listitem:
      - link "Alerting":
        - /url: /alerting
      - 'button "Collapse section: Alerting"'
      - list:
        - listitem:
          - link "Alert rules":
            - /url: /alerting/list
        - listitem:
          - link "Contact points":
            - /url: /alerting/notifications
        - listitem:
          - link "Notification policies":
            - /url: /alerting/routes
        - listitem:
          - link "Silences":
            - /url: /alerting/silences
        - listitem:
          - link "Active notifications":
            - /url: /alerting/groups
        - listitem:
          - link "Recently deleted":
            - /url: /alerting/recently-deleted
        - listitem:
          - link "Settings":
            - /url: /alerting/admin
    - listitem:
      - link "Connections":
        - /url: /connections
      - 'button "Expand section: Connections"'
    - listitem:
      - link "More apps":
        - /url: /apps
      - 'button "Expand section: More apps"'
    - listitem:
      - link "Administration":
        - /url: /admin
      - 'button "Expand section: Administration"'
- banner:
  - navigation "Breadcrumbs":
    - list:
      - listitem:
        - link "Home":
          - /url: /
      - listitem:
        - link "Alerting":
          - /url: /alerting
      - listitem:
        - link "Alert rules":
          - /url: /alerting/list
      - listitem: New alert rule
  - button "Search..."
  - text: ctrl+k
  - button "New"
  - button "Help"
  - button "Profile":
    - img "User avatar"
  - button "Save rule and exit"
  - button "Cancel"
- main:
  - heading "New alert rule" [level=1]
  - group "1. Enter alert rule name":
    - text: 1. Enter alert rule name Enter a name to identify your alert rule. Name
    - textbox "name"
  - group "2. Define query and alert condition Advanced options Advanced options":
    - text: 2. Define query and alert condition Advanced options
    - switch "Advanced options"
    - text: Define query and alert condition Need help?
    - img "CloudWatch logo"
    - textbox "Select a data source"
    - img
    - button "Options"
    - text: "10 minutes Region:"
    - log
    - text: default
    - combobox "Region:"
    - log
    - text: CloudWatch Metrics
    - combobox "Query mode"
    - log
    - text: Metric Search
    - combobox "Metric editor mode"
    - button "Run queries"
    - radiogroup:
      - radio "Builder" [checked]
      - text: Builder
      - radio "Code"
      - text: Code
    - text: Namespace
    - log
    - text: Choose
    - combobox "Namespace"
    - text: Metric name
    - log
    - text: Choose
    - combobox "Metric name"
    - text: Statistic
    - log
    - text: Average
    - combobox "Statistic"
    - text: Dimensions
    - button "Add"
    - text: Match exact - optional
    - img
    - switch "Match exact - optional" [checked]
    - text: ID - optional
    - img
    - textbox "ID - optional"
    - text: Period
    - img
    - textbox "Period"
    - text: Label - optional
    - img
    - code:
      - textbox "Editor content;Press Alt+F1 for Accessibility Options."
    - text: Alert condition WHEN
    - log
    - text: Last
    - combobox
    - text: OF QUERY
    - button "Is above"
    - spinbutton: "0"
    - button "Preview alert rule condition"
  - group "3. Add folder and labels":
    - text: 3. Add folder and labels Organize your alert rule with a folder and set of labels. Need help? Folder Select a folder to store your rule in.
    - button "Select folder"
    - button "New folder"
    - heading "Labels" [level=5]
    - text: Add labels to your rule for searching, silencing, or routing to a notification policy. Need help?
    - list "Labels"
    - text: No labels selected
    - button "Add labels"
  - group "4. Set evaluation behavior":
    - text: 4. Set evaluation behavior Define how the alert rule is evaluated. Need help? Select a folder before setting evaluation group and interval
    - log
    - text: Select an evaluation group... or
    - button "New evaluation group" [disabled]
    - text: Pending period Period during which the threshold condition must be met to trigger an alert. Selecting "None" triggers the alert immediately once the condition is met.
    - textbox "Pending period Period during which the threshold condition must be met to trigger an alert. Selecting \"None\" triggers the alert immediately once the condition is met.": 1m
    - listbox:
      - option "None"
      - option "1m" [selected]
      - option "2m"
      - option "3m"
      - option "4m"
      - option "5m"
    - separator
    - text: Keep firing for Period during which the alert will continue to show up as firing even though the threshold condition is no longer breached. Selecting "None" means the alert will be back to normal immediately.
    - textbox "Keep firing for Period during which the alert will continue to show up as firing even though the threshold condition is no longer breached. Selecting \"None\" means the alert will be back to normal immediately.": 0s
    - listbox:
      - option "None" [selected]
      - option "1m"
      - option "2m"
      - option "3m"
      - option "4m"
      - option "5m"
    - button "Configure no data and error handling"
  - group "5. Configure notifications Advanced options Advanced options":
    - text: 5. Configure notifications Advanced options
    - switch "Advanced options"
    - text: Select who should receive a notification when an alert rule fires.
    - heading "Recipient" [level=5]
    - text: "Notifications for firing alerts are routed to a selected contact point. Need help? Alertmanager:"
    - img "Alert manager logo"
    - text: grafana Contact point
    - log
    - text: Choose
    - combobox
    - button "Refresh contact points list"
    - link "View or create contact points":
      - /url: /alerting/notifications
    - button "Muting, grouping and timings (optional)"
    - text: Muting, grouping and timings (optional)
  - group "6. Configure notification message":
    - text: 6. Configure notification message Add more context to your alert notifications. Need help? Summary (optional) Short summary of what happened and why.
    - textbox "Summary (optional)"
    - text: Description (optional) Description of what the alert rule does.
    - textbox "Description (optional)"
    - text: Runbook URL (optional) Webpage where you keep your runbook for the alert.
    - textbox "Runbook URL (optional)"
    - button "Add custom annotation"
    - button "Link dashboard and panel"
- alert
- alert
- complementary
- complementary
```

# Test source

```ts
   1 | import * as semver from 'semver';
   2 | import { Locator } from '@playwright/test';
   3 | import { PluginTestCtx } from '../../types';
   4 | import { GrafanaPage } from '../pages/GrafanaPage';
   5 |
   6 | export class DataSourcePicker extends GrafanaPage {
   7 |   constructor(
   8 |     ctx: PluginTestCtx,
   9 |     private root?: Locator
  10 |   ) {
  11 |     super(ctx);
  12 |   }
  13 |
  14 |   /**
  15 |    * Sets the data source picker to the provided name
  16 |    */
  17 |   async set(name: string) {
  18 |     let datasourcePicker = (this.root || this.ctx.page).getByTestId(
  19 |       this.ctx.selectors.components.DataSourcePicker.inputV2
  20 |     );
  21 |
  22 |     if (semver.lt(this.ctx.grafanaVersion, '10.1.0')) {
  23 |       datasourcePicker = this.getByGrafanaSelector(this.ctx.selectors.components.DataSourcePicker.container, {
  24 |         root: this.root,
  25 |       }).locator('input');
  26 |     }
  27 |
> 28 |     await datasourcePicker.fill(name);
     |                            ^ Error: locator.fill: Test timeout of 30000ms exceeded.
  29 |
  30 |     // this is a hack to get the selection to work in 10.ish versions of Grafana.
  31 |     // TODO: investigate if the select component can somehow be refactored so that its easier to test with playwright
  32 |     await this.ctx.page.keyboard.press('ArrowDown');
  33 |     await this.ctx.page.keyboard.press('ArrowUp');
  34 |     await this.ctx.page.keyboard.press('Enter');
  35 |   }
  36 | }
  37 |
```

# Local changes

```diff
diff --git a/package-lock.json b/package-lock.json
index d90e9df9..a4dc3cc7 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -23,6 +23,7 @@
         "@auto-it/omit-commits": "11.3.0",
         "@auto-it/slack": "11.3.0",
         "@grafana/eslint-config": "^8.0.0",
+        "@playwright/test": "^1.52.0",
         "@rollup/plugin-commonjs": "^28.0.3",
         "@rollup/plugin-json": "^6.1.0",
         "@rollup/plugin-node-resolve": "^16.0.1",
@@ -6822,11 +6823,13 @@
       }
     },
     "node_modules/@playwright/test": {
-      "version": "1.51.1",
+      "version": "1.52.0",
+      "resolved": "https://registry.npmjs.org/@playwright/test/-/test-1.52.0.tgz",
+      "integrity": "sha512-uh6W7sb55hl7D6vsAeA+V2p5JnlAqzhqFyF0VcJkKZXkgnFcVG9PziERRHQfPLfNGx1C292a4JqbWzhR8L4R1g==",
       "dev": true,
       "license": "Apache-2.0",
       "dependencies": {
-        "playwright": "1.51.1"
+        "playwright": "1.52.0"
       },
       "bin": {
         "playwright": "cli.js"
@@ -24283,11 +24286,13 @@
       }
     },
     "node_modules/playwright": {
-      "version": "1.51.1",
+      "version": "1.52.0",
+      "resolved": "https://registry.npmjs.org/playwright/-/playwright-1.52.0.tgz",
+      "integrity": "sha512-JAwMNMBlxJ2oD1kce4KPtMkDeKGHQstdpFPcPH3maElAXon/QZeTvtsfXmTMRyO9TslfoYOXkSsvao2nE1ilTw==",
       "dev": true,
       "license": "Apache-2.0",
       "dependencies": {
-        "playwright-core": "1.51.1"
+        "playwright-core": "1.52.0"
       },
       "bin": {
         "playwright": "cli.js"
@@ -24300,7 +24305,9 @@
       }
     },
     "node_modules/playwright-core": {
-      "version": "1.51.1",
+      "version": "1.52.0",
+      "resolved": "https://registry.npmjs.org/playwright-core/-/playwright-core-1.52.0.tgz",
+      "integrity": "sha512-l2osTgLXSMeuLZOML9qYODUQoPPnUsKsb5/P6LJ2e6uPKXUdPK5WYhN4z03G+YNbWmGDY4YENauNu4ZKczreHg==",
       "dev": true,
       "license": "Apache-2.0",
       "bin": {
@@ -24312,7 +24319,10 @@
     },
     "node_modules/playwright/node_modules/fsevents": {
       "version": "2.3.2",
+      "resolved": "https://registry.npmjs.org/fsevents/-/fsevents-2.3.2.tgz",
+      "integrity": "sha512-xiqMQR4xAeHTuB9uWm+fFRcIOgKBMiOBP+eXiyT7jsgVCq1bkVygt00oASowB7EdtpOHaaPgKt812P9ab+DDKA==",
       "dev": true,
+      "hasInstallScript": true,
       "license": "MIT",
       "optional": true,
       "os": [
@@ -31871,7 +31881,7 @@
         "yaml": "^2.3.4"
       },
       "devDependencies": {
-        "@playwright/test": "^1.51.1",
+        "@playwright/test": "^1.52.0",
         "@types/uuid": "^10.0.0",
         "dotenv": "^16.5.0"
       },
diff --git a/package.json b/package.json
index 55bf79ab..94a402c9 100644
--- a/package.json
+++ b/package.json
@@ -28,6 +28,7 @@
     "@auto-it/omit-commits": "11.3.0",
     "@auto-it/slack": "11.3.0",
     "@grafana/eslint-config": "^8.0.0",
+    "@playwright/test": "^1.52.0",
     "@rollup/plugin-commonjs": "^28.0.3",
     "@rollup/plugin-json": "^6.1.0",
     "@rollup/plugin-node-resolve": "^16.0.1",
diff --git a/packages/create-plugin/templates/common/_package.json b/packages/create-plugin/templates/common/_package.json
index 44fddfad..84575143 100644
--- a/packages/create-plugin/templates/common/_package.json
+++ b/packages/create-plugin/templates/common/_package.json
@@ -23,7 +23,7 @@
     "@grafana/eslint-config": "^8.0.0",{{#if usePlaywright}}
     "@grafana/plugin-e2e": "^1.17.1",{{/if}}
     "@grafana/tsconfig": "^2.0.0",{{#if usePlaywright}}
-    "@playwright/test": "1.51.1",{{/if}}
+    "@playwright/test": "^1.52.0",{{/if}}
     "@stylistic/eslint-plugin-ts": "^2.9.0",
     "@swc/core": "^1.3.90",
     "@swc/helpers": "^0.5.0",
diff --git a/packages/create-plugin/templates/common/playwright.config b/packages/create-plugin/templates/common/playwright.config
index f7af173a..9c8c609f 100644
--- a/packages/create-plugin/templates/common/playwright.config
+++ b/packages/create-plugin/templates/common/playwright.config
@@ -46,9 +46,6 @@ export default defineConfig<PluginOptions>({
       use: {
         ...devices['Desktop Chrome'],
         storageState: 'playwright/.auth/admin.json',
-        launchOptions: {
-          args: ['--disable-features=PlzDedicatedWorker'], // because https://github.com/microsoft/playwright/pull/34400
-        },
       },
       dependencies: ['auth'],
     },
diff --git a/packages/plugin-e2e/package.json b/packages/plugin-e2e/package.json
index e643f059..f8a3dfbe 100644
--- a/packages/plugin-e2e/package.json
+++ b/packages/plugin-e2e/package.json
@@ -36,7 +36,7 @@
     "@playwright/test": "^1.41.2"
   },
   "devDependencies": {
-    "@playwright/test": "^1.51.1",
+    "@playwright/test": "^1.52.0",
     "@types/uuid": "^10.0.0",
     "dotenv": "^16.5.0"
   },
diff --git a/packages/plugin-e2e/playwright.config.ts b/packages/plugin-e2e/playwright.config.ts
index 8a2a5b84..667c7401 100644
--- a/packages/plugin-e2e/playwright.config.ts
+++ b/packages/plugin-e2e/playwright.config.ts
@@ -83,9 +83,6 @@ export default defineConfig<PluginOptions>({
       testDir: './tests/as-admin-user',
       use: {
         ...devices['Desktop Chrome'],
-        launchOptions: {
-          args: ['--disable-features=PlzDedicatedWorker'], // because https://github.com/microsoft/playwright/pull/34400
-        },
         storageState: 'playwright/.auth/admin.json',
         viewport: {
           width: 1920,
@@ -100,9 +97,6 @@ export default defineConfig<PluginOptions>({
       testDir: './tests/as-viewer-user',
       use: {
         ...devices['Desktop Chrome'],
-        launchOptions: {
-          args: ['--disable-features=PlzDedicatedWorker'], // because https://github.com/microsoft/playwright/pull/34400
-        },
         storageState: 'playwright/.auth/viewer.json',
       },
       dependencies: ['createUserAndAuthenticate'],
diff --git a/packages/plugin-e2e/src/models/pages/GrafanaPage.ts b/packages/plugin-e2e/src/models/pages/GrafanaPage.ts
index 7603e2a2..59ea2e0c 100644
--- a/packages/plugin-e2e/src/models/pages/GrafanaPage.ts
+++ b/packages/plugin-e2e/src/models/pages/GrafanaPage.ts
@@ -19,7 +19,7 @@ export abstract class GrafanaPage {
       url += `?${queryParams.toString()}`;
     }
     await this.ctx.page.goto(url, {
-      waitUntil: 'networkidle',
+      waitUntil: 'load',
       ...this.pageArgs,
       ...options,
     });
diff --git a/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts b/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts
index c8c06927..e176a8b8 100644
--- a/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts
+++ b/packages/plugin-e2e/tests/as-admin-user/app/app-config/appConfig.spec.ts
@@ -16,6 +16,6 @@ test('should wait for plugin config settings API to respond', async ({ gotoAppCo
   );
 
   const response = configPage.waitForSettingsResponse();
-  await page.getByRole('button', { name: 'Disable' }).first().click();
+  await page.getByRole('button', { name: /Disable|Enable/i }).first().click();
   await expect(response).toBeOK();
 });
diff --git a/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts b/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts
index 51eb8f92..68316e84 100644
--- a/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts
+++ b/packages/plugin-e2e/tests/as-admin-user/datasource/query-editor/queryEditor.integration.spec.ts
@@ -33,3 +33,5 @@ test('should be possible to load and execute an existing valid query', async ({
   await expect(panelEditPage.refreshPanel()).toBeOK();
   await expect(panelEditPage.panel.getErrorIcon()).not.toBeVisible();
 });
+
+// DEBUG=pw:browser
```