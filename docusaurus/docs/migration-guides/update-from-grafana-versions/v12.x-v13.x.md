---
id: migrate-12_x-to-13_x
title: 12.x to 13.x
sidebar_position: 1
description: How to migrate plugins from Grafana version 12.x to 13.x.
keywords:
  - grafana
  - plugins
  - plugin
  - upgrading
  - updating
  - migration
  - react 19
---

# Migrate plugins from Grafana version 12.x to 13.x

This guide helps you migrate plugins from Grafana version 12.x to 13.x.

## Prerequisites

Before starting the migration:

- Back up your plugin code
- Ensure your development environment is up to date
- Build your plugin with `npm run build`

## React 19 upgrade

As part of the Grafana 13 release, Grafana has updated from React 18 to [React 19](https://react.dev/blog/2024/12/05/react-19). This update ensures Grafana stays aligned with the broader React ecosystem and benefits from ongoing performance enhancements and new functionality.

For most plugins, this update requires only minor code changes and a dependency audit to ensure compatibility with React 19.

### How this update impacts plugins

Grafana shares a single React instance with all loaded plugins at runtime. This means updating the React version in your plugin's `package.json` file doesn't change the runtime version. Instead, the goal is to align to Grafana's runtime and focus on forward-compatible code.

:::warning
Don't attempt to force a different React version or bundle React. Pinning a different version locally results in a test environment that is inconsistent with the Grafana runtime environment.
:::

### Detect compatibility issues

Use the [`@grafana/react-detect`](https://www.npmjs.com/package/@grafana/react-detect) CLI tool to scan your plugin's built JavaScript files and source code for potential compatibility issues. Run the following commands from the root of your plugin:

```bash
npm run build
npx -y @grafana/react-detect@latest
```

The output identifies locations in your source code or dependencies that use React features affected by the breaking changes in React 19.

:::info
The CLI tool can create false positives, particularly if your source code or a dependency supports multiple versions of React. It's meant to be a first step in identifying where incompatible code may live.
:::

As you address issues in your plugin, re-run `npm run build` before running the react-detect CLI again.

### React 19 breaking changes

React 19 introduces the following breaking changes that may affect the functionality of plugins:

- Removal of `propTypes` checks and `defaultProps` on function components
- Removal of legacy context API (`contextTypes` and `getChildContext`)
- Removal of string refs
- Removal of `createFactory`
- Removal of `ReactDOM.findDOMNode`
- Removal of `ReactDOM.render` and `ReactDOM.unmountComponentAtNode`
- Renaming of internal React API `__SECRET_INTERNALS_DO_NOT_USE`

Refer to the [React 19 upgrade guide](https://react.dev/blog/2024/04/25/react-19-upgrade-guide) for a full list of breaking changes.

### Fix the jsx-runtime issue

The `__SECRET_INTERNALS_DO_NOT_USE` API rename is the most likely cause of plugin loading issues. Some React dependencies and the `react/jsx-runtime` module rely on these internals. In React 19, these internals were renamed, which means dependencies that expect the old name may fail or crash at runtime.

To solve this issue, externalize the jsx-runtime modules in your plugin's webpack configuration:

:::warning
Applying this fix makes your plugin incompatible with versions of Grafana earlier than 12.3.0.
:::

1. Create a `webpack.config.ts` file in the root of your plugin's repository:

```typescript
import type { Configuration } from 'webpack';
import { merge } from 'webpack-merge';
import grafanaConfig, { type Env } from './.config/webpack/webpack.config';

const config = async (env: Env): Promise<Configuration> => {
  const baseConfig = await grafanaConfig(env);

  return merge(baseConfig, {
    externals: ['react/jsx-runtime', 'react/jsx-dev-runtime'],
  });
};

export default config;
```

2. Update the plugin's `package.json` to use the new webpack configuration:

```json
"scripts": {
  "build": "webpack -c ./webpack.config.ts --env production",
  "dev": "webpack -w -c ./webpack.config.ts --env development"
}
```

3. Change the `grafanaDependency` in `src/plugin.json` to `>=12.3.0` to signal to plugin users that the plugin no longer supports older versions of Grafana.

### Common dependency issues

The following table lists common plugin dependencies that may be flagged by `@grafana/react-detect` and the recommended actions to resolve them.

#### Dependencies that require the jsx-runtime fix {#jsx-runtime-deps}

These dependencies bundle `react/jsx-runtime` at build time. At runtime this causes the plugin to fail because React 19 has renamed its internal API. To solve this issue, follow the steps in [Fix the jsx-runtime issue](#fix-the-jsx-runtime-issue) to externalize the jsx-runtime modules.

| Dependency              | Minimum version | Notes                                                                                         |
| ----------------------- | --------------- | --------------------------------------------------------------------------------------------- |
| `@tanstack/react-query` | latest          | Requires the jsx-runtime fix.                                                                 |
| `@grafana/faro-react`   | `^2.2.3`        | Bumping to `^2.2.3` resolves the issue without the jsx-runtime fix. Otherwise, apply the fix. |
| `react-window`          | `^1.8.11`       | Also bump to `^1.8.11` to resolve the `defaultProps` flag.                                    |
| `react-markdown`        | latest          | `propTypes` were removed in v9. Also requires the jsx-runtime fix.                            |

#### Dependencies that require a version bump {#version-bump-deps}

These dependencies have released React 19-compatible versions. Update to the specified minimum version to resolve any flagged issues.

| Dependency                        | Minimum version | Notes                                                                                                                             |
| --------------------------------- | --------------- | --------------------------------------------------------------------------------------------------------------------------------- |
| `react-draggable`                 | `^4.4.0`        | Pass the `nodeRef` prop to avoid `findDOMNode` usage. See [example](#react-draggable-noderef-example).                            |
| `react-resizable`                 | `^3.1.3`        | `propTypes` and `defaultProps` flags are false positives (class component).                                                       |
| `rc-resize-observer`              | `^1.0.0`        | The underlying `rc-util` package removed `findDOMNode` in v1.1.0.                                                                 |
| `rc-motion`                       | `^2.9.5`        | The underlying `rc-util` package removed `findDOMNode` in v1.1.0.                                                                 |
| `rc-trigger`                      | `^5.3.4`        | The underlying `rc-util` package removed `findDOMNode` in v1.1.0. `defaultProps` on the class component is not a breaking change. |
| `@hello-pangea/dnd`               | `^18.0.0`       | `ReactDOM.render` flag is a false positive.                                                                                       |
| `@react-awesome-query-builder/ui` | `^6.6.15`       | `defaultProps` are on class components (not a breaking change). `propTypes` are silently ignored.                                 |
| `react-virtualized-auto-sizer`    | `^2.0.0`        | `defaultProps` were removed in v2.                                                                                                |

#### Dependencies with warnings {#warning-deps}

These dependencies are compatible with React 19 but may have behavioral changes if not used correctly.

| Dependency               | Flags                                      | Action                                                                                                                                                                                                                              |
| ------------------------ | ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `react-transition-group` | `defaultProps`, `findDOMNode`, `propTypes` | Pass the `nodeRef` prop to components to avoid `ReactDOM.findDOMNode` errors. Be aware that `defaultProps` on function components are no longer applied, which may affect behavior. See [details](#react-transition-group-details). |

#### False positives {#false-positives}

The following dependencies are flagged by `@grafana/react-detect` but don't require any changes:

| Dependency        | Flag              | Reason                                                                                       |
| ----------------- | ----------------- | -------------------------------------------------------------------------------------------- |
| `@grafana/scenes` | `ReactDOM.render` | Caused by `react-use/esm/useScratch.js` which imports `{ render }` from a different package. |
| `style-mod`       | `ReactDOM.render` | Caused by its own internal `render` function.                                                |

### Dependency fix details

#### react-draggable: pass the `nodeRef` prop {#react-draggable-noderef-example}

To avoid `findDOMNode` usage, pass a `nodeRef` prop to the `Draggable` component:

```tsx
function MyComponent() {
  const nodeRef = React.useRef(null);
  return (
    <Draggable nodeRef={nodeRef}>
      <div ref={nodeRef}>Example Target</div>
    </Draggable>
  );
}
```

#### react-transition-group: pass the `nodeRef` prop {#react-transition-group-details}

Pass the `nodeRef` prop to `react-transition-group` components. Without it, the library attempts to call `ReactDOM.findDOMNode`, which results in errors in React 19.

Be aware of the following `defaultProps` on function components that are no longer applied in React 19. If you rely on default behavior, explicitly pass these props:

- `SwitchTransition`: `{ mode: 'out-in' }`
- `Transition`: `{ in: false, mountOnEnter: false, unmountOnExit: false, appear: false, enter: true, exit: true }`
- `TransitionGroup`: `{ component: 'div', childFactory: (child) => child }`

### Verify fixes locally

To test your plugin against React 19, use the developer preview Docker image:

```bash
GRAFANA_VERSION=dev-preview-react19 docker compose up --build
```

Once running, navigate your plugin's features to check that everything behaves as expected. If you have end-to-end (e2e) tests, run them against the `dev-preview-react19` image to help identify any problems.

After verifying React 19 compatibility, also verify that the plugin continues to work in a build of Grafana that uses React 18 to ensure backward compatibility.

### Update CI pipelines

To make sure your plugin stays compatible with multiple Grafana versions that include React 19, use the e2e testing workflow that automatically runs your tests against multiple Grafana versions.

If you're already using the e2e testing workflow (scaffolded by default), add the `skip-grafana-react-19-preview-image` input parameter:

```diff
  - name: Resolve Grafana E2E versions
    id: resolve-versions
    uses: grafana/plugin-actions/e2e-version@e2e-version/v1.2.1
+   with:
+     skip-grafana-react-19-preview-image: false
```

### Common questions

#### Should I already start using React 19 functionality?

Please do not upgrade react to 19 in any plugins. We are focusing on forward-compatible code right now as we need to be able to easily switch back to react 18 Grafana build should something go wrong. We cannot do that if plugins start adopting new react 19 features. Once the dust has settled we will update the `@grafana/runtime|data|ui` npm packages to officially support react 19.
